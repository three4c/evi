import{r as f,l as p,o as L,m as A}from"./shortcuts-Bdqo3K1J.js";const T=["INPUT","TEXTAREA"],R=()=>{const a=f.useRef("insert"),g=f.useRef({start:0,end:0}),[h,d]=f.useState({}),k=n=>n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement?n:null,E=(n,r)=>{let t=0,e=0,i=0;const l=n.value.split(`
`);for(let s=0;s<l.length;s++){const c=l[s].length+1;if(t+c>r){e=s,i=r-t;break}t+=c}return{lines:l,charCount:t,currentLine:e,col:i}},y=(n,r)=>{let{start:t,end:e}=g.current;a.current==="normal"&&(t=n.selectionStart||0,e=t+1);const{lines:i,charCount:l,currentLine:s,col:c}=E(n,t);if(r.key==="h"&&c&&(t--,e=t+1),r.key==="l"&&c!==i[s].length-1&&(t++,e=t+1),r.key==="j"&&s+1<i.length){const o=i[s+1].length,u=l+i[s].length+1;if(o){const v=c>=o?c-o+1:0;t=u+c-v}else t=u;e=t+1}if(r.key==="k"&&s>0){const o=i[s-1].length,u=l-(i[s-1].length+1);if(o){const v=c>=o?c-o+1:0;t=u+c-v}else t=u;e=t+1}if(r.key==="o"&&n.tagName==="TEXTAREA"){const o=n.value.indexOf(`
`,t);t=o===-1?n.value.length:o,n.value=[n.value.slice(0,t),n.value.slice(t,n.value.length)].join(`
`),t=e=t+1,a.current="insert"}if(r.key==="O"&&n.tagName==="TEXTAREA"){const o=n.value.lastIndexOf(`
`,t-1);t=o===-1?0:o,n.value=[n.value.slice(0,t),n.value.slice(t,n.value.length)].join(`
`),t=e=t+(t?1:0),a.current="insert"}i[s].length&&c===i[s].length&&(t=t-1,e=t+1),r.key==="i"&&(e=t),r.key==="a"&&(t=e),["i","a"].includes(r.key)&&(a.current="insert"),r.key==="v"&&(a.current="visual"),g.current={start:t,end:e},n.setSelectionRange(t,e)};return f.useEffect(()=>{p().then(d),L(d)},[]),f.useEffect(()=>{const n=r=>{const t=document.activeElement,e=k(t);e&&T.includes(e.tagName)&&(h.normal_mode&&A(r,h.normal_mode)&&(a.current="normal"),["normal","visual"].includes(a.current)&&(y(e,r),r.preventDefault()))};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[h]),null};export{R as A};
