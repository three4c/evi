import{r as h,l as L,o as A,m as S}from"./shortcuts-Bdqo3K1J.js";const R=["INPUT","TEXTAREA"],j=()=>{const s=h.useRef("insert"),d=h.useRef({start:0,end:0}),u=h.useRef(void 0),[g,k]=h.useState({}),x=e=>e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?e:null,T=(e,i)=>{let t=0,n=0,a=0;const f=e.value.split(`
`);for(let o=0;o<f.length;o++){const c=f[o].length+1;if(t+c>i){n=o,a=i-t;break}t+=c}return{lines:f,charCount:t,currentLine:n,col:a}},w=async(e,i)=>{var y,p,E;let{start:t,end:n}=d.current;s.current==="normal"&&(t=e.selectionStart||0,n=t+1);const{lines:a,charCount:f,currentLine:o,col:c}=T(e,t);if(s.current==="normal"){if(i.key==="h"&&c&&(t--,n=t+1),i.key==="l"&&c!==a[o].length-1&&(t++,n=t+1),i.key==="j"&&o+1<a.length){const r=a[o+1].length,l=f+a[o].length+1;if(r){const v=c>=r?c-r+1:0;t=l+c-v}else t=l;n=t+1}if(i.key==="k"&&o>0){const r=a[o-1].length,l=f-(a[o-1].length+1);if(r){const v=c>=r?c-r+1:0;t=l+c-v}else t=l;n=t+1}a[o].length&&c===a[o].length&&(t=t-1,n=t+1)}if(s.current==="visual"&&u.current){const{start:r,end:l}=u.current;if(i.key==="h"&&t!==0?n-t===1?t<=r?t--:n--:t<r?t--:n--:i.key==="h"&&n!==1&&n--,i.key==="l"&&n!==e.value.length?n-t===1?n>=l?n++:t++:n>l?n++:t++:i.key==="l"&&t!==e.value.length-1&&t++,i.key==="y"){const v=(y=window.getSelection())==null?void 0:y.toString();v&&(navigator.clipboard.writeText(v),s.current="normal",t=r,n=l)}}if(i.key==="o"&&e.tagName==="TEXTAREA"){const r=e.value.indexOf(`
`,t);t=r===-1?e.value.length:r,e.value=[e.value.slice(0,t),e.value.slice(t,e.value.length)].join(`
`),t=n=t+1,s.current="insert"}if(i.key==="O"&&e.tagName==="TEXTAREA"){const r=e.value.lastIndexOf(`
`,t-1);t=r===-1?0:r,e.value=[e.value.slice(0,t),e.value.slice(t,e.value.length)].join(`
`),t=n=t+(t?1:0),s.current="insert"}if(i.key==="p"&&s.current==="normal"){const r=await navigator.clipboard.readText();if(r){const l=a[o].length===0?t:n;e.value=[e.value.slice(0,l),e.value.slice(l,e.value.length)].join(r),t=t+r.length,n=t+1}}if(i.key==="P"&&s.current==="normal"){const r=await navigator.clipboard.readText();r&&(e.value=[e.value.slice(0,t),e.value.slice(t,e.value.length)].join(r),t=t+r.length-1,n=t+1)}i.key==="i"&&(n=t),i.key==="a"&&(t=n),["i","a"].includes(i.key)&&(s.current="insert"),i.key==="v"&&(s.current==="normal"?(s.current="visual",u.current={start:t,end:n,currentLine:o}):(s.current="normal",t=((p=u.current)==null?void 0:p.start)||t,n=((E=u.current)==null?void 0:E.end)||n,u.current=void 0)),d.current={start:t,end:n},e.setSelectionRange(t,n)};return h.useEffect(()=>{L().then(k),A(k)},[]),h.useEffect(()=>{const e=i=>{const t=document.activeElement,n=x(t);n&&R.includes(n.tagName)&&(g.normal_mode&&S(i,g.normal_mode)&&(s.current="normal"),["normal","visual"].includes(s.current)&&(w(n,i),i.preventDefault()))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[g]),null};export{j as A};
