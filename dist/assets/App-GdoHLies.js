import{r as h,l as L,o as A,m as S}from"./shortcuts-Bdqo3K1J.js";const R=["INPUT","TEXTAREA"],j=()=>{const o=h.useRef("insert"),d=h.useRef({start:0,end:0}),f=h.useRef(void 0),[g,k]=h.useState({}),x=n=>n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement?n:null,T=(n,r)=>{let t=0,e=0,s=0;const v=n.value.split(`
`);for(let a=0;a<v.length;a++){const c=v[a].length+1;if(t+c>r){e=a,s=r-t;break}t+=c}return{lines:v,charCount:t,currentLine:e,col:s}},w=async(n,r)=>{var y,p,E;let{start:t,end:e}=d.current;o.current==="normal"&&(t=n.selectionStart||0,e=t+1);const{lines:s,charCount:v,currentLine:a,col:c}=T(n,t);if(o.current==="normal"){if(r.key==="h"&&c&&(t--,e=t+1),r.key==="l"&&c!==s[a].length-1&&(t++,e=t+1),r.key==="j"&&a+1<s.length){const i=s[a+1].length,l=v+s[a].length+1;if(i){const u=c>=i?c-i+1:0;t=l+c-u}else t=l;e=t+1}if(r.key==="k"&&a>0){const i=s[a-1].length,l=v-(s[a-1].length+1);if(i){const u=c>=i?c-i+1:0;t=l+c-u}else t=l;e=t+1}if(r.key==="o"&&n.tagName==="TEXTAREA"){const i=n.value.indexOf(`
`,t);t=i===-1?n.value.length:i,n.value=[n.value.slice(0,t),n.value.slice(t,n.value.length)].join(`
`),t=e=t+1,o.current="insert"}if(r.key==="O"&&n.tagName==="TEXTAREA"){const i=n.value.lastIndexOf(`
`,t-1);t=i===-1?0:i,n.value=[n.value.slice(0,t),n.value.slice(t,n.value.length)].join(`
`),t=e=t+(t?1:0),o.current="insert"}if(r.key==="p"){const i=await navigator.clipboard.readText();if(i){const l=s[a].length===0?t:e;n.value=[n.value.slice(0,l),n.value.slice(l,n.value.length)].join(i),t=t+i.length,e=t+1}}if(r.key==="P"){const i=await navigator.clipboard.readText();i&&(n.value=[n.value.slice(0,t),n.value.slice(t,n.value.length)].join(i),t=t+i.length-1,e=t+1)}s[a].length&&c===s[a].length&&(t=t-1,e=t+1)}if(o.current==="visual"&&f.current){const{start:i,end:l}=f.current;if(r.key==="h"&&t!==0?e-t===1?t<=i?t--:e--:t<i?t--:e--:r.key==="h"&&e!==1&&e--,r.key==="l"&&e!==n.value.length?e-t===1?e>=l?e++:t++:e>l?e++:t++:r.key==="l"&&t!==n.value.length-1&&t++,r.key==="p"||r.key==="P"){const u=await navigator.clipboard.readText();u&&(n.value=[n.value.slice(0,t),n.value.slice(e,n.value.length)].join(u),t=t+u.length-1,e=t+1,o.current="normal")}if(r.key==="y"){const u=(y=window.getSelection())==null?void 0:y.toString();u&&(navigator.clipboard.writeText(u),o.current="normal",t=i,e=l)}}r.key==="i"&&(e=t),r.key==="a"&&(t=e),["i","a"].includes(r.key)&&(o.current="insert"),r.key==="v"&&(o.current==="normal"?(o.current="visual",f.current={start:t,end:e,currentLine:a}):(o.current="normal",t=((p=f.current)==null?void 0:p.start)||t,e=((E=f.current)==null?void 0:E.end)||e,f.current=void 0)),d.current={start:t,end:e},n.setSelectionRange(t,e)};return h.useEffect(()=>{L().then(k),A(k)},[]),h.useEffect(()=>{const n=r=>{const t=document.activeElement,e=x(t);e&&R.includes(e.tagName)&&(g.normal_mode&&S(r,g.normal_mode)&&(o.current="normal"),["normal","visual"].includes(o.current)&&(w(e,r),r.preventDefault()))};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}},[g]),null};export{j as A};
