import{r as v,l as _,o as B,m as M}from"./shortcuts-Bdqo3K1J.js";const I=["INPUT","TEXTAREA"],X=()=>{const l=v.useRef("insert"),L=v.useRef({start:0,end:0}),h=v.useRef(void 0),[k,E]=v.useState({}),j=e=>e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?e:null,T=(e,r)=>{let t=0,n=0,c=0;const s=e.value.split(`
`);for(let d=0;d<s.length;d++){const i=s[d].length+1;if(t+i>r){n=d,c=r-t;break}t+=i}return{lines:s,charCount:t,currentLine:n,col:c}},b=async(e,r)=>{var w,S,m;let{start:t,end:n}=L.current;const{length:c}=e.value;l.current==="normal"&&(t=e.selectionStart||0,n=t+1);const{lines:s,charCount:d,currentLine:i,col:f}=T(e,t),{currentLine:y}=T(e,n);if(l.current==="normal"&&!M(r,k.normal_mode)){if(r.key==="h"&&f&&(t--,n=t+1),r.key==="l"&&f!==s[i].length-1&&(t++,n=t+1),r.key==="j"&&i+1<s.length){const o=s[i+1].length,a=d+s[i].length+1;if(o){const g=f>=o?f-o+1:0;t=a+f-g}else t=a;n=t+1}if(r.key==="k"&&i>0){const o=s[i-1].length,a=d-(s[i-1].length+1);if(o){const g=f>=o?f-o+1:0;t=a+f-g}else t=a;n=t+1}if(r.key==="o"&&e.tagName==="TEXTAREA"){const o=e.value.indexOf(`
`,t);t=o===-1?c:o,e.value=[e.value.slice(0,t),e.value.slice(t,c)].join(`
`),t=n=t+1,l.current="insert"}if(r.key==="O"&&e.tagName==="TEXTAREA"){const o=e.value.lastIndexOf(`
`,t-1);t=o===-1?0:o,e.value=[e.value.slice(0,t),e.value.slice(t,c)].join(`
`),t=n=t+(t?1:0),l.current="insert"}if(r.key==="p"){const o=await navigator.clipboard.readText();if(o){const a=s[i].length===0?t:n;e.value=[e.value.slice(0,a),e.value.slice(a,c)].join(o),t=t+o.length,n=t+1}}if(r.key==="P"){const o=await navigator.clipboard.readText();o&&(e.value=[e.value.slice(0,t),e.value.slice(t,c)].join(o),t=t+o.length-1,n=t+1)}s[i].length&&f===s[i].length&&(t=t-1,n=t+1)}if(l.current==="visual"&&h.current){const{start:o,end:a,currentLine:g}=h.current,p=n-t===1,D=p?t<=o:t<o,N=p?n>=a:n>a,O=t===0&&o===0,P=n===c&&a===c,A=s[i].length+1,C=s[y].length+1,R=u=>Math.max(0,Math.min(u,c));if(r.key==="h"&&(t>0?D?t--:n--:O&&n!==1&&!p&&n--),r.key==="l"&&(n<c?N?n++:t++:P&&t!==c-1&&!p&&t++),r.key==="j"){const u=i+1<s.length,x=i>=g;u&&x?n=R(n+A):(t=t+A,t>n&&(t=o,n=c))}if(r.key==="k"){const u=y>0,x=y<=g;u&&x?t=R(t-C):(n=n-C,n<t&&(t=0,n=a))}if(r.key==="p"||r.key==="P"){const u=await navigator.clipboard.readText();u&&(e.setRangeText(u),t=t+u.length-1,n=t+1,l.current="normal")}if(r.key==="y"){const u=(w=window.getSelection())==null?void 0:w.toString();u&&(navigator.clipboard.writeText(u),l.current="normal",t=o,n=a)}}r.key==="i"&&(n=t),r.key==="a"&&(t=n),["i","a"].includes(r.key)&&(l.current="insert"),r.key==="v"&&(l.current==="normal"?(l.current="visual",h.current={start:t,end:n,currentLine:i}):(l.current="normal",t=((S=h.current)==null?void 0:S.start)||t,n=((m=h.current)==null?void 0:m.end)||n,h.current=void 0)),L.current={start:t,end:n},e.setSelectionRange(t,n)};return v.useEffect(()=>{_().then(E),B(E)},[]),v.useEffect(()=>{const e=r=>{const t=document.activeElement,n=j(t);n&&I.includes(n.tagName)&&(k.normal_mode&&M(r,k.normal_mode)&&(l.current="normal"),["normal","visual"].includes(l.current)&&(b(n,r),r.preventDefault()))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[k]),null};export{X as A};
