import{r as h,l as b,o as m,m as M}from"./shortcuts-Bdqo3K1J.js";const N=["INPUT","TEXTAREA"],P=()=>{const s=h.useRef("insert"),y=h.useRef({start:0,end:0}),d=h.useRef(void 0),[k,E]=h.useState({}),w=e=>e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?e:null,L=(e,i)=>{let t=0,n=0,a=0;const c=e.value.split(`
`);for(let v=0;v<c.length;v++){const o=c[v].length+1;if(t+o>i){n=v,a=i-t;break}t+=o}return{lines:c,charCount:t,currentLine:n,col:a}},S=async(e,i)=>{var p,x,T;let{start:t,end:n}=y.current;const{length:a}=e.value;s.current==="normal"&&(t=e.selectionStart||0,n=t+1);const{lines:c,charCount:v,currentLine:o,col:u}=L(e,t);if(s.current==="normal"){if(i.key==="h"&&u&&(t--,n=t+1),i.key==="l"&&u!==c[o].length-1&&(t++,n=t+1),i.key==="j"&&o+1<c.length){const r=c[o+1].length,l=v+c[o].length+1;if(r){const f=u>=r?u-r+1:0;t=l+u-f}else t=l;n=t+1}if(i.key==="k"&&o>0){const r=c[o-1].length,l=v-(c[o-1].length+1);if(r){const f=u>=r?u-r+1:0;t=l+u-f}else t=l;n=t+1}if(i.key==="o"&&e.tagName==="TEXTAREA"){const r=e.value.indexOf(`
`,t);t=r===-1?a:r,e.value=[e.value.slice(0,t),e.value.slice(t,a)].join(`
`),t=n=t+1,s.current="insert"}if(i.key==="O"&&e.tagName==="TEXTAREA"){const r=e.value.lastIndexOf(`
`,t-1);t=r===-1?0:r,e.value=[e.value.slice(0,t),e.value.slice(t,a)].join(`
`),t=n=t+(t?1:0),s.current="insert"}if(i.key==="p"){const r=await navigator.clipboard.readText();if(r){const l=c[o].length===0?t:n;e.value=[e.value.slice(0,l),e.value.slice(l,a)].join(r),t=t+r.length,n=t+1}}if(i.key==="P"){const r=await navigator.clipboard.readText();r&&(e.value=[e.value.slice(0,t),e.value.slice(t,a)].join(r),t=t+r.length-1,n=t+1)}c[o].length&&u===c[o].length&&(t=t-1,n=t+1)}if(s.current==="visual"&&d.current){const{start:r,end:l}=d.current,f=n-t===1,A=f?t<=r:t<r,R=f?n>=l:n>l,C=t===0&&r===0,j=n===a&&l===a;if(i.key==="h"&&(t>0?A?t--:n--:C&&n!==1&&!f&&n--),i.key==="l"&&(n<a?R?n++:t++:j&&t!==a-1&&!f&&t++),i.key==="p"||i.key==="P"){const g=await navigator.clipboard.readText();g&&(e.value=[e.value.slice(0,t),e.value.slice(n,a)].join(g),t=t+g.length-1,n=t+1,s.current="normal")}if(i.key==="y"){const g=(p=window.getSelection())==null?void 0:p.toString();g&&(navigator.clipboard.writeText(g),s.current="normal",t=r,n=l)}}i.key==="i"&&(n=t),i.key==="a"&&(t=n),["i","a"].includes(i.key)&&(s.current="insert"),i.key==="v"&&(s.current==="normal"?(s.current="visual",d.current={start:t,end:n,currentLine:o}):(s.current="normal",t=((x=d.current)==null?void 0:x.start)||t,n=((T=d.current)==null?void 0:T.end)||n,d.current=void 0)),y.current={start:t,end:n},e.setSelectionRange(t,n)};return h.useEffect(()=>{b().then(E),m(E)},[]),h.useEffect(()=>{const e=i=>{const t=document.activeElement,n=w(t);n&&N.includes(n.tagName)&&(k.normal_mode&&M(i,k.normal_mode)&&(s.current="normal"),["normal","visual"].includes(s.current)&&(S(n,i),i.preventDefault()))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[k]),null};export{P as A};
