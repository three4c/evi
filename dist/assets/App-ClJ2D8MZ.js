import{r as h,l as _,o as U,m as b}from"./shortcuts-Bdqo3K1J.js";const H=["INPUT","TEXTAREA"],K=()=>{const u=h.useRef("insert"),T=h.useRef({start:0,end:0}),d=h.useRef(void 0),[x,w]=h.useState({}),I=e=>e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?e:null,L=(e,r)=>{let t=0,n=0,o=0;const c=e.value.split(`
`);for(let v=0;v<c.length;v++){const s=c[v].length+1;if(t+s>r){n=v,o=r-t;break}t+=s}return{lines:c,charCount:t,currentLine:n,col:o}},B=async(e,r)=>{var E,S,R,A,C;let{start:t,end:n}=T.current;const{length:o}=e.value;u.current==="normal"&&(t=e.selectionStart||0,n=t+1);const{lines:c,charCount:v,currentLine:s,col:f}=L(e,t),{currentLine:y}=L(e,n);if(u.current==="normal"&&!b(r,x.normal_mode)){if(r.key==="h"&&f&&(t--,n=t+1),r.key==="l"&&f!==c[s].length-1&&(t++,n=t+1),r.key==="j"&&s+1<c.length){const i=c[s+1].length,a=v+c[s].length+1;if(i){const g=f>=i?f-i+1:0;t=a+f-g}else t=a;n=t+1}if(r.key==="k"&&s>0){const i=c[s-1].length,a=v-(c[s-1].length+1);if(i){const g=f>=i?f-i+1:0;t=a+f-g}else t=a;n=t+1}if(r.key==="J"){const i=e.value.indexOf(`
`,t);i>=0&&(t=i,n=i+1,e.value=[e.value.slice(0,t),e.value.slice(n,o)].join(" "))}if(r.key==="o"&&e.tagName==="TEXTAREA"){const i=e.value.indexOf(`
`,t);t=i===-1?o:i,e.value=[e.value.slice(0,t),e.value.slice(t,o)].join(`
`),t=n=t+1,u.current="insert"}if(r.key==="O"&&e.tagName==="TEXTAREA"){const i=e.value.lastIndexOf(`
`,t-1);t=i===-1?0:i,e.value=[e.value.slice(0,t),e.value.slice(t,o)].join(`
`),t=n=t+(t?1:0),u.current="insert"}if(r.key==="p"){const i=await navigator.clipboard.readText();if(i){const a=c[s].length===0?t:n;e.value=[e.value.slice(0,a),e.value.slice(a,o)].join(i),t=t+i.length,n=t+1}}if(r.key==="P"){const i=await navigator.clipboard.readText();i&&(e.value=[e.value.slice(0,t),e.value.slice(t,o)].join(i),t=t+i.length-1,n=t+1)}if(r.key==="x"){const i=(E=window.getSelection())==null?void 0:E.toString();i&&(navigator.clipboard.writeText(i),e.setRangeText(""))}r.key==="X"&&(t=t-1,n=n-1,navigator.clipboard.writeText(e.value.slice(t,t+1)),e.value=[e.value.slice(0,t),e.value.slice(n,o)].join("")),c[s].length&&f===c[s].length&&(t=t-1,n=t+1)}if(u.current==="visual"&&d.current){const{start:i,end:a,currentLine:g}=d.current,k=n-t===1,D=k?t<=i:t<i,N=k?n>=a:n>a,P=t===0&&i===0,X=n===o&&a===o,j=c[s].length+1,M=c[y].length+1,O=l=>Math.max(0,Math.min(l,o));if(r.key==="h"&&(t>0?D?t--:n--:P&&n!==1&&!k&&n--),r.key==="l"&&(n<o?N?n++:t++:X&&t!==o-1&&!k&&t++),r.key==="j"){const l=s+1<c.length,p=s>=g;l&&p?n=O(n+j):(t=t+j,t>n&&(t=i,n=o))}if(r.key==="k"){const l=y>0,p=y<=g;l&&p?t=O(t-M):(n=n-M,n<t&&(t=0,n=a))}if(r.key==="p"||r.key==="P"){const l=await navigator.clipboard.readText();l&&(e.setRangeText(l),t=t+l.length-1,n=t+1,u.current="normal")}if(r.key==="y"){const l=(S=window.getSelection())==null?void 0:S.toString();l&&(navigator.clipboard.writeText(l),u.current="normal",t=i,n=a)}if(r.key==="x"){const l=(R=window.getSelection())==null?void 0:R.toString();l&&(navigator.clipboard.writeText(l),e.setRangeText(""),t=i,n=a,u.current="normal")}}if(r.key==="i"&&(n=t),r.key==="I"&&(t=n=e.value.lastIndexOf(`
`,t)+1),r.key==="a"&&(t=n),r.key==="A"&&(t=n=e.value.indexOf(`
`,t)),r.key==="s"&&(e.setRangeText(""),n=t),r.key==="S"){const i=e.value.lastIndexOf(`
`,t)+1,a=e.value.indexOf(`
`,n);t=i===-1?0:i,n=a===-1?o:a,e.value=[e.value.slice(0,t),e.value.slice(n,o)].join(""),n=t}["i","I","a","A","s","S"].includes(r.key)&&(u.current="insert"),r.key==="v"&&(u.current==="normal"?(u.current="visual",d.current={start:t,end:n,currentLine:s}):(u.current="normal",t=((A=d.current)==null?void 0:A.start)||t,n=((C=d.current)==null?void 0:C.end)||n,d.current=void 0)),T.current={start:t,end:n},e.setSelectionRange(t,n)};return h.useEffect(()=>{_().then(w),U(w)},[]),h.useEffect(()=>{const e=r=>{const t=document.activeElement,n=I(t);n&&H.includes(n.tagName)&&(x.normal_mode&&b(r,x.normal_mode)&&(u.current="normal"),["normal","visual"].includes(u.current)&&(B(n,r),r.preventDefault()))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[x]),null};export{K as A};
