import{r as v,l as P,o as B,m as I}from"./shortcuts-Bdqo3K1J.js";const U=["INPUT","TEXTAREA"],_=()=>{const l=v.useRef("insert"),L=v.useRef({start:0,end:0}),d=v.useRef(void 0),[p,E]=v.useState({}),M=e=>e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?e:null,T=(e,o)=>{let t=0,n=0,c=0;const s=e.value.split(`
`);for(let h=0;h<s.length;h++){const i=s[h].length+1;if(t+i>o){n=h,c=o-t;break}t+=i}return{lines:s,charCount:t,currentLine:n,col:c}},j=async(e,o)=>{var w,S,A;let{start:t,end:n}=L.current;const{length:c}=e.value;l.current==="normal"&&(t=e.selectionStart||0,n=t+1);const{lines:s,charCount:h,currentLine:i,col:f}=T(e,t),{currentLine:y}=T(e,n);if(l.current==="normal"){if(o.key==="h"&&f&&(t--,n=t+1),o.key==="l"&&f!==s[i].length-1&&(t++,n=t+1),o.key==="j"&&i+1<s.length){const r=s[i+1].length,a=h+s[i].length+1;if(r){const g=f>=r?f-r+1:0;t=a+f-g}else t=a;n=t+1}if(o.key==="k"&&i>0){const r=s[i-1].length,a=h-(s[i-1].length+1);if(r){const g=f>=r?f-r+1:0;t=a+f-g}else t=a;n=t+1}if(o.key==="o"&&e.tagName==="TEXTAREA"){const r=e.value.indexOf(`
`,t);t=r===-1?c:r,e.value=[e.value.slice(0,t),e.value.slice(t,c)].join(`
`),t=n=t+1,l.current="insert"}if(o.key==="O"&&e.tagName==="TEXTAREA"){const r=e.value.lastIndexOf(`
`,t-1);t=r===-1?0:r,e.value=[e.value.slice(0,t),e.value.slice(t,c)].join(`
`),t=n=t+(t?1:0),l.current="insert"}if(o.key==="p"){const r=await navigator.clipboard.readText();if(r){const a=s[i].length===0?t:n;e.value=[e.value.slice(0,a),e.value.slice(a,c)].join(r),t=t+r.length,n=t+1}}if(o.key==="P"){const r=await navigator.clipboard.readText();r&&(e.value=[e.value.slice(0,t),e.value.slice(t,c)].join(r),t=t+r.length-1,n=t+1)}s[i].length&&f===s[i].length&&(t=t-1,n=t+1)}if(l.current==="visual"&&d.current){const{start:r,end:a,currentLine:g}=d.current,k=n-t===1,b=k?t<=r:t<r,D=k?n>=a:n>a,N=t===0&&r===0,O=n===c&&a===c,C=s[i].length+1,R=s[y].length+1,m=u=>Math.max(0,Math.min(u,c));if(o.key==="h"&&(t>0?b?t--:n--:N&&n!==1&&!k&&n--),o.key==="l"&&(n<c?D?n++:t++:O&&t!==c-1&&!k&&t++),o.key==="j"){const u=i+1<s.length,x=i>=g;u&&x?n=m(n+C):(t=t+C,t>n&&(t=r,n=c))}if(o.key==="k"){const u=y>0,x=y<=g;u&&x?t=m(t-R):(n=n-R,n<t&&(t=0,n=a))}if(o.key==="p"||o.key==="P"){const u=await navigator.clipboard.readText();u&&(e.setRangeText(u),t=t+u.length-1,n=t+1,l.current="normal")}if(o.key==="y"){const u=(w=window.getSelection())==null?void 0:w.toString();u&&(navigator.clipboard.writeText(u),l.current="normal",t=r,n=a)}}o.key==="i"&&(n=t),o.key==="a"&&(t=n),["i","a"].includes(o.key)&&(l.current="insert"),o.key==="v"&&(l.current==="normal"?(l.current="visual",d.current={start:t,end:n,currentLine:i}):(l.current="normal",t=((S=d.current)==null?void 0:S.start)||t,n=((A=d.current)==null?void 0:A.end)||n,d.current=void 0)),L.current={start:t,end:n},e.setSelectionRange(t,n)};return v.useEffect(()=>{P().then(E),B(E)},[]),v.useEffect(()=>{const e=o=>{const t=document.activeElement,n=M(t);n&&U.includes(n.tagName)&&(p.normal_mode&&I(o,p.normal_mode)&&(l.current="normal"),["normal","visual"].includes(l.current)&&(j(n,o),o.preventDefault()))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[p]),null};export{_ as A};
