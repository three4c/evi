import{r as h,l as P,o as X,m as j}from"./shortcuts-Bdqo3K1J.js";const _=["INPUT","TEXTAREA"],H=()=>{const l=h.useRef("insert"),L=h.useRef({start:0,end:0}),d=h.useRef(void 0),[k,E]=h.useState({}),O=e=>e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?e:null,T=(e,r)=>{let n=0,t=0,s=0;const a=e.value.split(`
`);for(let v=0;v<a.length;v++){const o=a[v].length+1;if(n+o>r){t=v,s=r-n;break}n+=o}return{lines:a,charCount:n,currentLine:t,col:s}},I=async(e,r)=>{var w,A,R;let{start:n,end:t}=L.current;const{length:s}=e.value;l.current==="normal"&&(n=e.selectionStart||0,t=n+1);const{lines:a,charCount:v,currentLine:o,col:f}=T(e,n),{currentLine:x}=T(e,t);if(l.current==="normal"&&!j(r,k.normal_mode)){if(r.key==="h"&&f&&(n--,t=n+1),r.key==="l"&&f!==a[o].length-1&&(n++,t=n+1),r.key==="j"&&o+1<a.length){const i=a[o+1].length,c=v+a[o].length+1;if(i){const g=f>=i?f-i+1:0;n=c+f-g}else n=c;t=n+1}if(r.key==="k"&&o>0){const i=a[o-1].length,c=v-(a[o-1].length+1);if(i){const g=f>=i?f-i+1:0;n=c+f-g}else n=c;t=n+1}if(r.key==="J"){const i=e.value.indexOf(`
`,n);i>=0&&(n=i,t=i+1,e.value=[e.value.slice(0,n),e.value.slice(t,s)].join(" "))}if(r.key==="o"&&e.tagName==="TEXTAREA"){const i=e.value.indexOf(`
`,n);n=i===-1?s:i,e.value=[e.value.slice(0,n),e.value.slice(n,s)].join(`
`),n=t=n+1,l.current="insert"}if(r.key==="O"&&e.tagName==="TEXTAREA"){const i=e.value.lastIndexOf(`
`,n-1);n=i===-1?0:i,e.value=[e.value.slice(0,n),e.value.slice(n,s)].join(`
`),n=t=n+(n?1:0),l.current="insert"}if(r.key==="p"){const i=await navigator.clipboard.readText();if(i){const c=a[o].length===0?n:t;e.value=[e.value.slice(0,c),e.value.slice(c,s)].join(i),n=n+i.length,t=n+1}}if(r.key==="P"){const i=await navigator.clipboard.readText();i&&(e.value=[e.value.slice(0,n),e.value.slice(n,s)].join(i),n=n+i.length-1,t=n+1)}r.key==="x"&&e.setRangeText(""),r.key==="X"&&(n=n-1,t=t-1,e.value=[e.value.slice(0,n),e.value.slice(t,s)].join("")),a[o].length&&f===a[o].length&&(n=n-1,t=n+1)}if(l.current==="visual"&&d.current){const{start:i,end:c,currentLine:g}=d.current,y=t-n===1,b=y?n<=i:n<i,D=y?t>=c:t>c,B=n===0&&i===0,N=t===s&&c===s,S=a[o].length+1,C=a[x].length+1,M=u=>Math.max(0,Math.min(u,s));if(r.key==="h"&&(n>0?b?n--:t--:B&&t!==1&&!y&&t--),r.key==="l"&&(t<s?D?t++:n++:N&&n!==s-1&&!y&&n++),r.key==="j"){const u=o+1<a.length,p=o>=g;u&&p?t=M(t+S):(n=n+S,n>t&&(n=i,t=s))}if(r.key==="k"){const u=x>0,p=x<=g;u&&p?n=M(n-C):(t=t-C,t<n&&(n=0,t=c))}if(r.key==="p"||r.key==="P"){const u=await navigator.clipboard.readText();u&&(e.setRangeText(u),n=n+u.length-1,t=n+1,l.current="normal")}if(r.key==="y"){const u=(w=window.getSelection())==null?void 0:w.toString();u&&(navigator.clipboard.writeText(u),l.current="normal",n=i,t=c)}}r.key==="i"&&(t=n),r.key==="I"&&(n=t=e.value.lastIndexOf(`
`,n)+1),r.key==="a"&&(n=t),r.key==="A"&&(n=t=e.value.indexOf(`
`,n)),["i","I","a","A"].includes(r.key)&&(l.current="insert"),r.key==="v"&&(l.current==="normal"?(l.current="visual",d.current={start:n,end:t,currentLine:o}):(l.current="normal",n=((A=d.current)==null?void 0:A.start)||n,t=((R=d.current)==null?void 0:R.end)||t,d.current=void 0)),L.current={start:n,end:t},e.setSelectionRange(n,t)};return h.useEffect(()=>{P().then(E),X(E)},[]),h.useEffect(()=>{const e=r=>{const n=document.activeElement,t=O(n);t&&_.includes(t.tagName)&&(k.normal_mode&&j(r,k.normal_mode)&&(l.current="normal"),["normal","visual"].includes(l.current)&&(I(t,r),r.preventDefault()))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[k]),null};export{H as A};
