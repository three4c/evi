import{r as v,l as T,o as w,m as L}from"./shortcuts-Bdqo3K1J.js";const A=["INPUT","TEXTAREA"],S=()=>{const i=v.useRef("insert"),d=v.useRef({start:0,end:0}),l=v.useRef({start:0,end:0}),[g,k]=v.useState({}),p=n=>n instanceof HTMLInputElement||n instanceof HTMLTextAreaElement?n:null,E=(n,s)=>{let t=0,e=0,o=0;const f=n.value.split(`
`);for(let a=0;a<f.length;a++){const c=f[a].length+1;if(t+c>s){e=a,o=s-t;break}t+=c}return{lines:f,charCount:t,currentLine:e,col:o}},x=async(n,s)=>{var y;let{start:t,end:e}=d.current;i.current==="normal"&&(t=n.selectionStart||0,e=t+1);const{lines:o,charCount:f,currentLine:a,col:c}=E(n,t);if(s.key==="h"&&c&&(i.current==="normal"?(t--,e=t+1):e-t===1?t<=l.current.start?t--:e--:t<l.current.start?t--:e--),s.key==="l"&&c!==o[a].length-1&&(i.current==="normal"?(t++,e=t+1):e-t===1?e>=l.current.end?e++:t++:e>l.current.end?e++:t++),s.key==="j"&&a+1<o.length){const r=o[a+1].length,u=f+o[a].length+1;if(r){const h=c>=r?c-r+1:0;t=u+c-h}else t=u;e=t+1}if(s.key==="k"&&a>0){const r=o[a-1].length,u=f-(o[a-1].length+1);if(r){const h=c>=r?c-r+1:0;t=u+c-h}else t=u;e=t+1}if(s.key==="o"&&n.tagName==="TEXTAREA"){const r=n.value.indexOf(`
`,t);t=r===-1?n.value.length:r,n.value=[n.value.slice(0,t),n.value.slice(t,n.value.length)].join(`
`),t=e=t+1,i.current="insert"}if(s.key==="O"&&n.tagName==="TEXTAREA"){const r=n.value.lastIndexOf(`
`,t-1);t=r===-1?0:r,n.value=[n.value.slice(0,t),n.value.slice(t,n.value.length)].join(`
`),t=e=t+(t?1:0),i.current="insert"}if(s.key==="y"&&i.current==="visual"){const r=(y=window.getSelection())==null?void 0:y.toString();r&&(navigator.clipboard.writeText(r),i.current="normal",t=l.current.start,e=l.current.end)}if(s.key==="p"&&i.current==="normal"){const r=await navigator.clipboard.readText();if(r){const u=o[a].length===0?t:e;n.value=[n.value.slice(0,u),n.value.slice(u,n.value.length)].join(r),t=t+r.length,e=t+1}}if(s.key==="P"&&i.current==="normal"){const r=await navigator.clipboard.readText();r&&(n.value=[n.value.slice(0,t),n.value.slice(t,n.value.length)].join(r),t=t+r.length-1,e=t+1)}o[a].length&&c===o[a].length&&(t=t-1,e=t+1),s.key==="i"&&(e=t),s.key==="a"&&(t=e),["i","a"].includes(s.key)&&(i.current="insert"),s.key==="v"&&(i.current==="normal"?(i.current="visual",l.current={start:t,end:e}):(i.current="normal",t=l.current.start,e=l.current.end)),d.current={start:t,end:e},n.setSelectionRange(t,e)};return v.useEffect(()=>{T().then(k),w(k)},[]),v.useEffect(()=>{const n=s=>{const t=document.activeElement,e=p(t);e&&A.includes(e.tagName)&&(g.normal_mode&&L(s,g.normal_mode)&&(i.current="normal"),["normal","visual"].includes(i.current)&&(x(e,s),s.preventDefault()))};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}},[g]),null};export{S as A};
