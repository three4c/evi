import{r as f,l as L,o as p,m as y}from"./shortcuts-Bdqo3K1J.js";const w=["INPUT","TEXTAREA"],C=()=>{const u=f.useRef("insert"),m=f.useRef({start:0,end:0}),[h,d]=f.useState({}),v=o=>o instanceof HTMLInputElement||o instanceof HTMLTextAreaElement?o:null,k=(o,n)=>{let t=0,e=0,c=0;const l=o.value.split(`
`);for(let r=0;r<l.length;r++){const s=l[r].length+1;if(t+s>n){e=r,c=n-t;break}t+=s}return{lines:l,charCount:t,currentLine:e,col:c}},E=(o,n)=>{let{start:t,end:e}=m.current;u.current==="normal"&&(t=o.selectionStart||0,e=t+1);const{lines:c,charCount:l,currentLine:r,col:s}=k(o,t);if(n.key==="h"&&s&&(t--,e=t+1),n.key==="l"&&s!==c[r].length-1&&(t++,e=t+1),n.key==="j"&&r+1<c.length){const i=c[r+1].length,a=l+c[r].length+1;if(i){const g=s>=i?s-i+1:0;t=a+s-g}else t=a;e=t+1}if(n.key==="k"&&r>0){const i=c[r-1].length,a=l-(c[r-1].length+1);if(i){const g=s>=i?s-i+1:0;t=a+s-g}else t=a;e=t+1}c[r].length&&s===c[r].length&&(t=t-1,e=t+1),n.key==="i"&&(e=t),n.key==="a"&&(t=e),["i","a"].includes(n.key)&&(u.current="insert"),n.key==="v"&&(u.current="visual"),m.current={start:t,end:e},o.setSelectionRange(t,e)};return f.useEffect(()=>{L().then(d),p(d)},[]),f.useEffect(()=>{const o=n=>{const t=document.activeElement,e=v(t);e&&w.includes(e.tagName)&&(h.normal_mode&&y(n,h.normal_mode)&&(u.current="normal"),["normal","visual"].includes(u.current)&&(E(e,n),n.preventDefault()))};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[h]),null};export{C as A};
