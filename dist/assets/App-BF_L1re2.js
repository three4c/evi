import{r as h,l as L,o as A,m as S}from"./shortcuts-Bdqo3K1J.js";const R=["INPUT","TEXTAREA"],j=()=>{const o=h.useRef("insert"),d=h.useRef({start:0,end:0}),f=h.useRef(void 0),[g,k]=h.useState({}),x=e=>e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?e:null,T=(e,r)=>{let t=0,n=0,c=0;const v=e.value.split(`
`);for(let a=0;a<v.length;a++){const l=v[a].length+1;if(t+l>r){n=a,c=r-t;break}t+=l}return{lines:v,charCount:t,currentLine:n,col:c}},w=async(e,r)=>{var y,p,E;let{start:t,end:n}=d.current;o.current==="normal"&&(t=e.selectionStart||0,n=t+1);const{lines:c,charCount:v,currentLine:a,col:l}=T(e,t);if(o.current==="normal"){if(r.key==="h"&&l&&(t--,n=t+1),r.key==="l"&&l!==c[a].length-1&&(t++,n=t+1),r.key==="j"&&a+1<c.length){const i=c[a+1].length,s=v+c[a].length+1;if(i){const u=l>=i?l-i+1:0;t=s+l-u}else t=s;n=t+1}if(r.key==="k"&&a>0){const i=c[a-1].length,s=v-(c[a-1].length+1);if(i){const u=l>=i?l-i+1:0;t=s+l-u}else t=s;n=t+1}if(r.key==="o"&&e.tagName==="TEXTAREA"){const i=e.value.indexOf(`
`,t);t=i===-1?e.value.length:i,e.value=[e.value.slice(0,t),e.value.slice(t,e.value.length)].join(`
`),t=n=t+1,o.current="insert"}if(r.key==="O"&&e.tagName==="TEXTAREA"){const i=e.value.lastIndexOf(`
`,t-1);t=i===-1?0:i,e.value=[e.value.slice(0,t),e.value.slice(t,e.value.length)].join(`
`),t=n=t+(t?1:0),o.current="insert"}if(r.key==="p"){const i=await navigator.clipboard.readText();if(i){const s=c[a].length===0?t:n;e.value=[e.value.slice(0,s),e.value.slice(s,e.value.length)].join(i),t=t+i.length,n=t+1}}if(r.key==="P"){const i=await navigator.clipboard.readText();i&&(e.value=[e.value.slice(0,t),e.value.slice(t,e.value.length)].join(i),t=t+i.length-1,n=t+1)}c[a].length&&l===c[a].length&&(t=t-1,n=t+1)}if(o.current==="visual"&&f.current){const{start:i,end:s}=f.current;if(r.key==="h"&&t>0?n-t===1?t<=i?t--:n--:t<i?t--:n--:r.key==="h"&&i===0&&n!==1&&n-t>1&&n--,r.key==="l"&&n<e.value.length?n-t===1?n>=s?n++:t++:n>s?n++:t++:r.key==="l"&&s===e.value.length&&t!==e.value.length-1&&n-t>1&&t++,r.key==="p"||r.key==="P"){const u=await navigator.clipboard.readText();u&&(e.value=[e.value.slice(0,t),e.value.slice(n,e.value.length)].join(u),t=t+u.length-1,n=t+1,o.current="normal")}if(r.key==="y"){const u=(y=window.getSelection())==null?void 0:y.toString();u&&(navigator.clipboard.writeText(u),o.current="normal",t=i,n=s)}}r.key==="i"&&(n=t),r.key==="a"&&(t=n),["i","a"].includes(r.key)&&(o.current="insert"),r.key==="v"&&(o.current==="normal"?(o.current="visual",f.current={start:t,end:n,currentLine:a}):(o.current="normal",t=((p=f.current)==null?void 0:p.start)||t,n=((E=f.current)==null?void 0:E.end)||n,f.current=void 0)),d.current={start:t,end:n},e.setSelectionRange(t,n)};return h.useEffect(()=>{L().then(k),A(k)},[]),h.useEffect(()=>{const e=r=>{const t=document.activeElement,n=x(t);n&&R.includes(n.tagName)&&(g.normal_mode&&S(r,g.normal_mode)&&(o.current="normal"),["normal","visual"].includes(o.current)&&(w(n,r),r.preventDefault()))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[g]),null};export{j as A};
