import{r as h,l as T,o as w,m as L}from"./shortcuts-Bdqo3K1J.js";const A=["INPUT","TEXTAREA"],R=()=>{const i=h.useRef("insert"),d=h.useRef({start:0,end:0}),u=h.useRef({start:0,end:0}),[g,k]=h.useState({}),E=e=>e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?e:null,p=(e,o)=>{let t=0,n=0,c=0;const f=e.value.split(`
`);for(let s=0;s<f.length;s++){const a=f[s].length+1;if(t+a>o){n=s,c=o-t;break}t+=a}return{lines:f,charCount:t,currentLine:n,col:c}},x=async(e,o)=>{var y;let{start:t,end:n}=d.current;i.current==="normal"&&(t=e.selectionStart||0,n=t+1);const{lines:c,charCount:f,currentLine:s,col:a}=p(e,t);if(i.current==="normal"){if(o.key==="h"&&a&&(t--,n=t+1),o.key==="l"&&a!==c[s].length-1&&(t++,n=t+1),o.key==="j"&&s+1<c.length){const r=c[s+1].length,l=f+c[s].length+1;if(r){const v=a>=r?a-r+1:0;t=l+a-v}else t=l;n=t+1}if(o.key==="k"&&s>0){const r=c[s-1].length,l=f-(c[s-1].length+1);if(r){const v=a>=r?a-r+1:0;t=l+a-v}else t=l;n=t+1}c[s].length&&a===c[s].length&&(t=t-1,n=t+1)}if(i.current==="visual"){const{start:r,end:l}=u.current;if(o.key==="h"&&t!==0?n-t===1?t<=r?t--:n--:t<r?t--:n--:o.key==="h"&&n!==1&&n--,o.key==="l"&&n!==e.value.length?n-t===1?n>=l?n++:t++:n>l?n++:t++:o.key==="l"&&t!==e.value.length-1&&t++,o.key==="y"){const v=(y=window.getSelection())==null?void 0:y.toString();v&&(navigator.clipboard.writeText(v),i.current="normal",t=r,n=l)}}if(console.log("start: ",t,"end: ",n,"oS: ",u.current.start,"oE: ",u.current.end,"col: ",a),o.key==="o"&&e.tagName==="TEXTAREA"){const r=e.value.indexOf(`
`,t);t=r===-1?e.value.length:r,e.value=[e.value.slice(0,t),e.value.slice(t,e.value.length)].join(`
`),t=n=t+1,i.current="insert"}if(o.key==="O"&&e.tagName==="TEXTAREA"){const r=e.value.lastIndexOf(`
`,t-1);t=r===-1?0:r,e.value=[e.value.slice(0,t),e.value.slice(t,e.value.length)].join(`
`),t=n=t+(t?1:0),i.current="insert"}if(o.key==="p"&&i.current==="normal"){const r=await navigator.clipboard.readText();if(r){const l=c[s].length===0?t:n;e.value=[e.value.slice(0,l),e.value.slice(l,e.value.length)].join(r),t=t+r.length,n=t+1}}if(o.key==="P"&&i.current==="normal"){const r=await navigator.clipboard.readText();r&&(e.value=[e.value.slice(0,t),e.value.slice(t,e.value.length)].join(r),t=t+r.length-1,n=t+1)}o.key==="i"&&(n=t),o.key==="a"&&(t=n),["i","a"].includes(o.key)&&(i.current="insert"),o.key==="v"&&(i.current==="normal"?(i.current="visual",u.current={start:t,end:n}):(i.current="normal",t=u.current.start,n=u.current.end)),d.current={start:t,end:n},e.setSelectionRange(t,n)};return h.useEffect(()=>{T().then(k),w(k)},[]),h.useEffect(()=>{const e=o=>{const t=document.activeElement,n=E(t);n&&A.includes(n.tagName)&&(g.normal_mode&&L(o,g.normal_mode)&&(i.current="normal"),["normal","visual"].includes(i.current)&&(x(n,o),o.preventDefault()))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[g]),null};export{R as A};
