import{r as g,l as N,o as P,m as j}from"./shortcuts-Bdqo3K1J.js";const _=["INPUT","TEXTAREA"],X=()=>{const l=g.useRef("insert"),L=g.useRef({start:0,end:0}),d=g.useRef(void 0),[k,E]=g.useState({}),O=e=>e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement?e:null,T=(e,i)=>{let n=0,t=0,a=0;const s=e.value.split(`
`);for(let v=0;v<s.length;v++){const o=s[v].length+1;if(n+o>i){t=v,a=i-n;break}n+=o}return{lines:s,charCount:n,currentLine:t,col:a}},I=async(e,i)=>{var w,A,S;let{start:n,end:t}=L.current;const{length:a}=e.value;l.current==="normal"&&(n=e.selectionStart||0,t=n+1);const{lines:s,charCount:v,currentLine:o,col:f}=T(e,n),{currentLine:x}=T(e,t);if(l.current==="normal"&&!j(i,k.normal_mode)){if(i.key==="h"&&f&&(n--,t=n+1),i.key==="l"&&f!==s[o].length-1&&(n++,t=n+1),i.key==="j"&&o+1<s.length){const r=s[o+1].length,c=v+s[o].length+1;if(r){const h=f>=r?f-r+1:0;n=c+f-h}else n=c;t=n+1}if(i.key==="k"&&o>0){const r=s[o-1].length,c=v-(s[o-1].length+1);if(r){const h=f>=r?f-r+1:0;n=c+f-h}else n=c;t=n+1}if(i.key==="J"){const r=e.value.indexOf(`
`,n);r>=0&&(n=r,t=r+1,e.value=[e.value.slice(0,n),e.value.slice(t,a)].join(" "))}if(i.key==="o"&&e.tagName==="TEXTAREA"){const r=e.value.indexOf(`
`,n);n=r===-1?a:r,e.value=[e.value.slice(0,n),e.value.slice(n,a)].join(`
`),n=t=n+1,l.current="insert"}if(i.key==="O"&&e.tagName==="TEXTAREA"){const r=e.value.lastIndexOf(`
`,n-1);n=r===-1?0:r,e.value=[e.value.slice(0,n),e.value.slice(n,a)].join(`
`),n=t=n+(n?1:0),l.current="insert"}if(i.key==="p"){const r=await navigator.clipboard.readText();if(r){const c=s[o].length===0?n:t;e.value=[e.value.slice(0,c),e.value.slice(c,a)].join(r),n=n+r.length,t=n+1}}if(i.key==="P"){const r=await navigator.clipboard.readText();r&&(e.value=[e.value.slice(0,n),e.value.slice(n,a)].join(r),n=n+r.length-1,t=n+1)}s[o].length&&f===s[o].length&&(n=n-1,t=n+1)}if(l.current==="visual"&&d.current){const{start:r,end:c,currentLine:h}=d.current,y=t-n===1,b=y?n<=r:n<r,m=y?t>=c:t>c,D=n===0&&r===0,B=t===a&&c===a,C=s[o].length+1,R=s[x].length+1,M=u=>Math.max(0,Math.min(u,a));if(i.key==="h"&&(n>0?b?n--:t--:D&&t!==1&&!y&&t--),i.key==="l"&&(t<a?m?t++:n++:B&&n!==a-1&&!y&&n++),i.key==="j"){const u=o+1<s.length,p=o>=h;u&&p?t=M(t+C):(n=n+C,n>t&&(n=r,t=a))}if(i.key==="k"){const u=x>0,p=x<=h;u&&p?n=M(n-R):(t=t-R,t<n&&(n=0,t=c))}if(i.key==="p"||i.key==="P"){const u=await navigator.clipboard.readText();u&&(e.setRangeText(u),n=n+u.length-1,t=n+1,l.current="normal")}if(i.key==="y"){const u=(w=window.getSelection())==null?void 0:w.toString();u&&(navigator.clipboard.writeText(u),l.current="normal",n=r,t=c)}}i.key==="i"&&(t=n),i.key==="I"&&(n=t=e.value.lastIndexOf(`
`,n)+1),i.key==="a"&&(n=t),i.key==="A"&&(n=t=e.value.indexOf(`
`,n)),["i","I","a","A"].includes(i.key)&&(l.current="insert"),i.key==="v"&&(l.current==="normal"?(l.current="visual",d.current={start:n,end:t,currentLine:o}):(l.current="normal",n=((A=d.current)==null?void 0:A.start)||n,t=((S=d.current)==null?void 0:S.end)||t,d.current=void 0)),L.current={start:n,end:t},e.setSelectionRange(n,t)};return g.useEffect(()=>{N().then(E),P(E)},[]),g.useEffect(()=>{const e=i=>{const n=document.activeElement,t=O(n);t&&_.includes(t.tagName)&&(k.normal_mode&&j(i,k.normal_mode)&&(l.current="normal"),["normal","visual"].includes(l.current)&&(I(t,i),i.preventDefault()))};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[k]),null};export{X as A};
